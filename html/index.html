<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Index Page</title>
</head>
<body>
  <h1>Welcome to the Index Page</h1>
  
  <button id="logoutButton">Logout</button>
  <button id="getProfileButton">Get Profile</button>
  <button id="goToAdminPageButton">Go to Admin Page</button>

  <script type="module">
    const logout = async () => {
    try {
        // Perform the logout logic (clear token, redirect, etc.)

        // Assuming your server's logout endpoint is at http://localhost:3000/logout
        const response = await fetch("http://localhost:3000/auth/logout", {
        method: "GET",
        credentials: "include",
        });

        if (response.ok) {
        console.log("Logout successful");

        // Redirect to the login page
        // window.location.href = "http://localhost:3000/login";
        window.location.href = "login.html";

        } else {
        const errorData = await response.json();
        console.error("Failed to logout. Errors:", errorData.message || "Unknown error");
        }
    } catch (error) {
        console.error("Error during logout:", error.message);
    }
    };

    const getProfile = async () => {
      try {
        // Fetch user profile logic
        const response = await fetch("http://localhost:3000/auth/profile", {
          method: "GET",
          credentials: 'include',
        });

        if (response.ok) {
          const profileData = await response.json();
          console.log("User profile:", profileData);
        } else {
          const errorData = await response.json();
          console.error("Failed to get user profile. Errors:", errorData.message || "Unknown error");
        }
      } catch (error) {
        console.error("Error during profile request:", error.message);
      }
    };

    const goToAdminPage = () => {
      // Redirect to the admin page, implement authorization logic here
      // For simplicity, let's assume there is a function isAdmin() that checks if the user is an admin
      if (isAdmin()) {
        // window.location.href = "http://localhost:3000/admin";
        window.location.href = "admin.html";
      } else {
        console.error("User is not authorized to access the admin page");
      }
    };

    document.addEventListener("DOMContentLoaded", () => {
      const logoutButton = document.getElementById("logoutButton");
      const getProfileButton = document.getElementById("getProfileButton");
      const goToAdminPageButton = document.getElementById("goToAdminPageButton");

      logoutButton.addEventListener("click", () => {
        // Call the logout function when the button is clicked
        logout();
      });

      getProfileButton.addEventListener("click", () => {
        // Call the getProfile function when the button is clicked
        getProfile();
      });

      goToAdminPageButton.addEventListener("click", () => {
        // Call the goToAdminPage function when the button is clicked
        goToAdminPage();
      });
    });

    // Placeholder function, replace with your actual authorization logic
    const isAdmin = () => {
      // Implement your logic to check if the user is an admin
      // For example, check user roles or permissions
      return true; // Replace with your actual logic
    };
  </script>
</body>
</html>
